/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.6.1/userguide/tutorial_java_projects.html
 */

plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building a CLI application.
    id 'application'

    id "de.undercouch.download" version "4.0.4"
    id "uk.co.boothen.gradle.wsimport" version "0.16"
}

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

// tag::configurations[]
configurations {
    jaxb
}
// end::configurations[]

repositories {
    mavenCentral()
}


application {
    // Define the main class for the application.
    mainClassName = 'demo.soap.spring.client.App'
}

task downloadWSDL(type: Download) {
    src 'http://127.0.0.1:8080/ws/countries.wsdl'
    dest "src/main/resources/"
}

// tag::wsdl[]
task genJaxb {
    ext.sourcesDir = "${buildDir}/generated-sources/jaxb"
    ext.classesDir = "${buildDir}/classes/jaxb"
    ext.schema = "src/main/resources/countries.wsdl"

    outputs.dir classesDir

    doLast() {
        project.ant {
            taskdef name: "xjc", classname: "com.sun.tools.xjc.XJC2Task",
                    classpath: configurations.jaxb.asPath
            mkdir(dir: sourcesDir)
            mkdir(dir: classesDir)

            xjc(destdir: sourcesDir, schema: schema,
                    package: "com.example.consumingwebservice.wsdl") {
                arg(value: "-wsdl")
                produces(dir: sourcesDir, includes: "**/*.java")

            }

            javac(destdir: classesDir, source: 11, target: 11, debug: true,
                    debugLevel: "lines,vars,source",
                    classpath: configurations.jaxb.asPath) {
                src(path: sourcesDir)
                include(name: "**/*.java")
                include(name: "*.java")
            }

            copy(todir: classesDir) {
                fileset(dir: sourcesDir, erroronmissingdir: false) {
                    exclude(name: "**/*.java")
                }
            }
        }
    }
}
// end::wsdl[]


/* wsimport {
    // wsdlSourceRoot = "src/main/resources/"
    // generatedSourceRoot = "/generated-sources/wsdl"
    // generatedClassesRoot = "/classes/wsdl"

//	target = "2.2"
//	keep = true
//	extension = true
//	verbose = true
//	quiet = false
//	debug = true
//	xnocompile = true

    wsdl = "src/main/resources/countries.wsdl"
}*/

dependencies {
    // This dependency is used by the application.
    // implementation 'com.google.guava:guava:29.0-jre'

    // For Java 11:
    implementation 'org.glassfish.jaxb:jaxb-runtime:2.3.3'
    implementation(files(genJaxb.classesDir).builtBy(genJaxb))
    jaxb "com.sun.xml.bind:jaxb-xjc:2.3.3"

    // Use JUnit test framework
    testImplementation 'junit:junit:4.12'
}
